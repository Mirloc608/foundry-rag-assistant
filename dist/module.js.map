{"version":3,"file":"module.js","sources":["../src/settings.ts","../src/module.ts"],"sourcesContent":["export const MODULE_ID = \"foundry-rag-assistant\";\r\n\r\nexport const SETTINGS = {\r\n  BACKEND_URL: \"backendUrl\",\r\n  AUTH_TOKEN: \"authToken\",\r\n  MODEL: \"model\"\r\n} as const;\r\n\r\nexport function registerSettings() {\r\n  game.settings.register(MODULE_ID, SETTINGS.BACKEND_URL, {\r\n    name: \"RAG.Setting.BackendURL\",\r\n    hint: \"RAG.Setting.BackendURLHint\",\r\n    scope: \"world\",\r\n    config: true,\r\n    type: String,\r\n    default: \"https://foundry.dmathome.com/rag\",\r\n    requiresReload: true\r\n  });\r\n\r\n  game.settings.register(MODULE_ID, SETTINGS.AUTH_TOKEN, {\r\n    name: \"RAG.Setting.AuthToken\",\r\n    hint: \"RAG.Setting.AuthTokenHint\",\r\n    scope: \"world\",\r\n    config: true,\r\n    type: String,\r\n    default: \"\"\r\n  });\r\n\r\n  game.settings.register(MODULE_ID, SETTINGS.MODEL, {\r\n    name: \"RAG.Setting.Model\",\r\n    hint: \"RAG.Setting.ModelHint\",\r\n    scope: \"world\",\r\n    config: true,\r\n    type: String,\r\n    choices: {\r\n      \"llama3\": \"Llama 3\",\r\n      \"mistral\": \"Mistral\",\r\n      \"phi3\": \"Phi-3\",\r\n      \"qwen2\": \"Qwen 2\"\r\n    },\r\n    default: \"llama3\"\r\n  });\r\n}\r\n\r\nexport function getBackendBase(): string {\r\n  return (game.settings.get(MODULE_ID, SETTINGS.BACKEND_URL) as string).replace(/\\/+$/, \"\");\r\n}\r\n\r\nexport function getAuthToken(): string | null {\r\n  const v = game.settings.get(MODULE_ID, SETTINGS.AUTH_TOKEN) as string;\r\n  return v?.trim() || null;\r\n}\r\n\r\nexport function getSelectedModel(): string {\r\n  return game.settings.get(MODULE_ID, SETTINGS.MODEL) as string;\r\n}\r\n","import { RagControlPanel } from \"./ragPanel\";\r\nimport { RagChatSidebar } from \"./chatSidebar\";\r\nimport { registerSettings } from \"./settings\";\r\n\r\nHooks.once(\"init\", () => {\r\n  console.log(\"Foundry RAG Assistant | Initializing\");\r\n  registerSettings();\r\n});\r\n\r\nHooks.on(\"getSceneControlButtons\", (controls) => {\r\n  const tokenControls = controls.find(c => c.name === \"token\");\r\n  if (!tokenControls) return;\r\n\r\n  tokenControls.tools.push({\r\n    name: \"rag-assistant\",\r\n    title: \"RAG Assistant\",\r\n    icon: \"fas fa-brain\",\r\n    button: true,\r\n    onClick: () => game.ragAssistant.openPanel()\r\n  });\r\n});\r\n\r\n\r\nHooks.on(\"renderChatLog\", (app, html, data) => {\r\n  const controls = html.find(\".control-buttons\");\r\n  if (!controls.length) return;\r\n\r\n  const btn = $(\r\n    `<a class=\"rag-chat-button\" title=\"RAG Assistant\">\r\n       <i class=\"fas fa-brain\"></i>\r\n     </a>`\r\n  );\r\n\r\n  btn.on(\"click\", () => game.ragAssistant.openPanel());\r\n  controls.append(btn);\r\n});\r\n\r\nclass RAGAssistantApp extends Application {\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: \"rag-assistant\",\r\n      title: \"RAG Assistant\",\r\n      template: \"modules/foundry-rag-assistant/templates/panel.html\",\r\n      width: 400,\r\n      height: 600,\r\n      resizable: true\r\n    });\r\n  }\r\n}\r\n\r\nHooks.once(\"ready\", () => {\r\n  game.ragAssistant = new RAGAssistantApp();\r\n});\r\n"],"names":["MODULE_ID","SETTINGS","registerSettings","controls","tokenControls","c","app","html","data","btn","RAGAssistantApp"],"mappings":"AAAO,MAAMA,EAAY,wBAEZC,EAAW,CACtB,YAAa,aACb,WAAY,YACZ,MAAO,OACT,EAEO,SAASC,GAAmB,CACjC,KAAK,SAAS,SAASF,EAAWC,EAAS,YAAa,CACtD,KAAM,yBACN,KAAM,6BACN,MAAO,QACP,OAAQ,GACR,KAAM,OACN,QAAS,mCACT,eAAgB,EAAA,CACjB,EAED,KAAK,SAAS,SAASD,EAAWC,EAAS,WAAY,CACrD,KAAM,wBACN,KAAM,4BACN,MAAO,QACP,OAAQ,GACR,KAAM,OACN,QAAS,EAAA,CACV,EAED,KAAK,SAAS,SAASD,EAAWC,EAAS,MAAO,CAChD,KAAM,oBACN,KAAM,wBACN,MAAO,QACP,OAAQ,GACR,KAAM,OACN,QAAS,CACP,OAAU,UACV,QAAW,UACX,KAAQ,QACR,MAAS,QAAA,EAEX,QAAS,QAAA,CACV,CACH,CCtCA,MAAM,KAAK,OAAQ,IAAM,CACvB,QAAQ,IAAI,sCAAsC,EAClDC,EAAA,CACF,CAAC,EAED,MAAM,GAAG,yBAA2BC,GAAa,CAC/C,MAAMC,EAAgBD,EAAS,KAAKE,GAAKA,EAAE,OAAS,OAAO,EACtDD,GAELA,EAAc,MAAM,KAAK,CACvB,KAAM,gBACN,MAAO,gBACP,KAAM,eACN,OAAQ,GACR,QAAS,IAAM,KAAK,aAAa,UAAA,CAAU,CAC5C,CACH,CAAC,EAGD,MAAM,GAAG,gBAAiB,CAACE,EAAKC,EAAMC,IAAS,CAC7C,MAAML,EAAWI,EAAK,KAAK,kBAAkB,EAC7C,GAAI,CAACJ,EAAS,OAAQ,OAEtB,MAAMM,EAAM,EACV;AAAA;AAAA,UAAA,EAKFA,EAAI,GAAG,QAAS,IAAM,KAAK,aAAa,WAAW,EACnDN,EAAS,OAAOM,CAAG,CACrB,CAAC,EAED,MAAMC,UAAwB,WAAY,CACxC,WAAW,gBAAiB,CAC1B,OAAO,YAAY,MAAM,eAAgB,CACvC,GAAI,gBACJ,MAAO,gBACP,SAAU,qDACV,MAAO,IACP,OAAQ,IACR,UAAW,EAAA,CACZ,CACH,CACF,CAEA,MAAM,KAAK,QAAS,IAAM,CACxB,KAAK,aAAe,IAAIA,CAC1B,CAAC"}